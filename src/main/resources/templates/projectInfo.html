<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>就业信息</title>
    <!-- <div th:replace="indexTemplates/head"></div> -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="layui/css/layui.css">
    <style>
        .block {
            box-shadow: rgb(235, 232, 232) 10px 1px 30px;
            /* background: #FFF; */
            padding: 40px;
            margin: 20px 0;
        }
    </style>
</head>

<body>
<!--导航栏开始-->
<div th:replace="indexTemplates/nav"></div>
<!--导航栏结束-->
    <br>
    <div class="content">
        <h3 th:text="${project.pName}" >就业创业咨询指导平台</h3>
        <label th:text="${project.publishTime}">2020-03-04</label><br>
        <button id="colecbtn" style="display: inline" type="button" class="layui-btn layui-btn-primary layui-btn-sm"><i class="layui-icon"></i></button>
        <button type="button" style="display: inline" id="messagebtn" class=" layui-btn layui-btn-normal  layui-btn-sm">私信up</button><br>

        <div style="display:none;width: 600px;" id="messdiv">
            <textarea id="messagearea" class="layui-textarea"></textarea>
            <button id="send" style="float: right" class="layui-btn layui-btn-sm">发送</button>
            <button id="cancel" style="float: right;margin-left: 10px" class="layui-btn layui-btn-warm layui-btn-sm">取消</button>
        </div>
        <hr>
        <div class="block" style="width: 780px;float: left;display: inline;">
            <label >项目进展</label>
            <hr>
            <p th:text="${project.evolve}">创意阶段</p>
            <br>
            <br>
            <label>项目概述</label>
            <hr>
            <div id="survey">
            </div>
            <br>
            <br>
            <label >备注</label>
            <hr>
            <p th:text="${project.remark}">创意阶段</p>
            <br>
        </div>
        <div class="block" style="width: 400px;float: left;display: inline;">
            <label>评论</label>
            <hr>
            <div id="commentblock" style="margin-bottom: 20px; max-height:400px;overflow-y:scroll;">
                <div th:each="comment:${comments}">
                    <p th:text="${comment.cotent}">这个好</p>
                    <br>
                </div>
            </div>
            <div>
                <textarea id="comment" placeholder="评论" class="layui-textarea"></textarea>
                <br>
                <button id="commentsub" class="layui-btn">提交</button>
            </div>
        </div>
    </div>
    <script src="layui/layui.all.js"></script>
    <!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) -->
    <script src="js/jquery.min.js"></script>
    <!-- 加载 Bootstrap 的所有 JavaScript 插件。你也可以根据需要只加载单个插件。 -->
    <script src="js/bootstrap.min.js"></script>
    <script th:inline="javascript">
        $(function(){
            var id=/*[[${project.id}]]*/1;
            var survey=/*[[${project.survey}]]*/"";
            console.log(survey);
            document.getElementById("survey").innerHTML=survey;
            $("#messagebtn").click(function(){
                $("#messdiv").css("display","block")
            });
            $("#cancel").click(function(){
                $("#messdiv").css("display","none")
            });
            $("#commentsub").click(function(){
                var comment=$("#comment").val();
                $.ajax({
                    url: "/comment?id="+id+"&comment="+comment,
                    success: function (msg) {
                        console.log(msg);
                        if(msg=="200"){
                            var html=$("<p>"+comment+"</p><br>");
                            $("#commentblock").prepend(html);
                            alert("评论成功");
                        } else{
                            alert(msg);
                        }
                    }
                });
            });
            $("#send").click(function(){
                var mess=$("#messagearea").val();
                $.ajax({
                    url: "/privateletter?pid="+id+"&mess="+mess,
                    success: function (msg) {
                        console.log(msg);
                        $("#messdiv").css("display","none");
                        if(msg!=200){
                            alert(msg);
                        }else{
                            alert("发送成功");
                        }
                    }
                });
            });
            var isCollect=/*[[${isCollect}]]*/"0";
            if(isCollect=="1"){
                $("#colecbtn").css("background","yellow");
            }
            $("#colecbtn").click(function(){
                if(isCollect=="0"){
                    $.ajax({
                        url: "/collectProject?pid="+id,
                        success: function (msg) {
                            console.log(msg);
                            if(msg!=200){
                                alert(msg);
                            }else{
                                $("#colecbtn").css("background","yellow");
                                alert("收藏成功");
                            }
                        }
                    });
                }else if(isCollect=="1"){
                    alert("已收藏");
                }
            });
        });
    </script>
</body>

</html>